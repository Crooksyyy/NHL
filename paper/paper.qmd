---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---
https://www.hockey-reference.com/friv/current_nhl_salaries.cgi
https://www.nhl.com/stats/skaters
```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(arrow)
library(here)
library(palmerpenguins)
```


# Introduction

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

The data in this paper was obtained from the NHL official website and hockey-reference(site). The dataset consists of 448 NHL players, their position, games played, goals, assists, points, plus/minus, points per game, time on ice per game, salary and their cap hit. These variables were chosen as they are generally easy to understand as a measure of how good a player is. With the goal of this paper in mind, there needs to be a measure of how productive the player is and how much they are paid. In the NHL there are two different measures of how much a player is paid, salary which measures the overall compensation a players gets paid, and cap hit which measures how much of the salary limit the player gets paid. These values can be different for a number of reasons such as bonuses or having a two-way contract with both the NHL team and its affiliated minor league teams. 

```{r}
#| label: fig-points-scatter 
#| fig-cap: Bills of penguins
#| echo: false

analysis_data <- read_parquet(here::here("data/analysis_data/analysis_data.parquet"))


# Scatter plot for Points vs. Salary
ggplot(analysis_data, aes(x = Points, y = Salary)) +
  geom_point() +
  labs(title = "Points vs. Salary",
       x = "Points",
       y = "Salary")

# Scatter plot for Points vs. Cap Hit
ggplot(analysis_data, aes(x = Points, y = CapHit)) +
  geom_point() +
  labs(title = "Points vs. Cap Hit",
       x = "Points",
       y = "Cap Hit")


```

@fig-points-scatter illustrates a naive approach to analyze how much a player should or should not be paid. Based on this approach players on the bottum right corner are producing lots of points and are relatively underpaid. The players in the top right are highly paid and producing like they should be. Players in the top left would be considered overpaid as they are not scoring but are highly paid. Scoring is not the only things that describes how good a player is. Specifically this approach is flawed for measuring how valuable defense man are. Because of this other measures can be used, one of the simplest is a players plus/minus. A plus is obtained if you are on the ice when your team scores and a minus when the other team scores.  

```{r}
#| label: fig-plusminus
#| fig-cap: Bills of penguins
#| echo: false


# Define a threshold for highlighting players with lots of points
points_threshold <- 75  # You can adjust this threshold as needed

# Create the scatter plot with point size based on Points
ggplot(analysis_data, aes(x = PlusMinus, y = Salary, color = Position, size = Points > points_threshold)) +
  geom_point(alpha = 0.7) +  # Adjust transparency for better visualization
  scale_size_manual(values = c(1, 3)) +  # Adjust size of points
  labs(title = "PlusMinus vs. Salary (Highlighted by Points)",
       x = "PlusMinus",
       y = "Salary",
       size = "High Points") +
  theme_minimal()

```

@fig-plusminus uses the plus/minus and salary to illustrate aspects beside scoring. Plus/minus may be a better measure than goals, assists or points as it includes defense, which the other statistics do not. However, can still measure if your team produces offense when they are on the ice. Plus/minus is also a better measure of deference man as preventing goals is more important for defense, than scoring goals. This graph emphasizes players with more than 75 points. We can see that the majority of the players with more than 75 points also have a positive plus/minus. It also shows a number of players with high plus/minus are not top scorers as the top 3 players in plus/minus, have less than 75 points. 


# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  
``` {=tex}
\[
\text{Salary}_i | \mu_i, \sigma \sim \text{Normal}(\mu_i, \sigma)
\]
\[
\mu_i = \alpha + \beta_{\text{Points}} \times \text{Points}_i + \beta_{\text{PlusMinus}} \times \text{PlusMinus}_i + \beta_{\text{PointsPerGame}} \times \text{PointsPerGame}_i
\]
\[
\alpha \sim \text{Normal}(0, 2.5)
\]
\[
\beta_{\text{Points}}, \beta_{\text{PlusMinus}}, \beta_{\text{PointsPerGame}} \sim \text{Normal}(0, 2.5)
\]
\[
\sigma \sim \text{Exponential}(1)
\]
```
In this representation, \( \text{Salary}_i \) represents the salary of player \( i \), \( \text{Points}_i \), \( \text{PlusMinus}_i \), and \( \text{PointsPerGame}_i \) represent the points, plus-minus, and points per game of player \( i \) respectively, and \( \alpha \), \( \beta_{\text{Points}} \), \( \beta_{\text{PlusMinus}} \), and \( \beta_{\text{PointsPerGame}} \) represent the intercept and coefficients for these variables, respectively. 

  
We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

#posterior_vs_prior(first_model) +
#  theme_minimal() +
#  scale_color_brewer(palette = "Set1") +
#  theme(legend.position = "bottom") +
#  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


